<!DOCTYPE html><html class="appearance-auto" lang="zh-CN"><head><meta charset="UTF-8"><title>实战项目练习-【2018世界杯】用Python分析夺冠球队</title><meta name="description"><meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, initial-scale=1"><link rel="icon" href="/images/favicon.png"><link rel="stylesheet" href="/style/common/bulma.css"><link rel="stylesheet" href="/style/base.css"><link rel="stylesheet" href="/style/common/helper.css"><script src="/js/common.js"></script><link rel="stylesheet" href="/style/post.css"><link rel="stylesheet" href="/style/themes/highlight-theme-light.css"><script src="/js/highlight.pack.js"></script><meta name="generator" content="Hexo 5.3.0"></head><body class="is-flex is-flex-direction-column"><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-space-between is-hidden-mobile"><section class="is-hidden-mobile is-flex-shrink-0"><h2><a href="/">loannes's blog</a></h2></section><h3 class="is-hidden-mobile is-family-serif is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height" id="postTopic"><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">实战项目练习-【2018世界杯】用Python分析夺冠球队</p><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">点击返回顶部</p></div></h3><aside class="is-flex-shrink-0"><h3 class="is-inline-block"><a href="/">首页</a></h3><h3 class="is-inline-block"><a href="/about">关于</a></h3><h3 class="is-inline-block"><a href="/archives">归档</a></h3></aside></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-center is-hidden-tablet"><h3 class="is-inline-block"><a href="/">首页</a></h3><h3 class="is-inline-block"><a href="/about">关于</a></h3><h3 class="is-inline-block"><a href="/archives">归档</a></h3></header><main><main class="container is-max-widescreen content section post-page pt-4 px-4"><div class="columns is-flex-desktop is-justify-content-center is-flex-direction-row-reverse"><div class="column is-3 is-hidden-mobile"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E6%9E%90%E7%9B%AE%E7%9A%84"><span class="toc-text">分析目的</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83"><span class="toc-text">开发环境</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9D%E6%AD%A5%E5%88%86%E6%9E%90%E6%95%B0%E6%8D%AE%E6%83%85%E5%86%B5"><span class="toc-text">初步分析数据情况</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E6%9E%90%E6%80%9D%E8%B7%AF"><span class="toc-text">分析思路</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E4%B8%96%E7%95%8C%E6%9D%AF%E7%9B%B8%E5%85%B3%E6%95%B0%E6%8D%AE"><span class="toc-text">获取世界杯相关数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B4%E7%90%86%E6%95%B0%E6%8D%AE"><span class="toc-text">整理数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E8%8E%B7%E8%83%9C%E5%9C%BA%E6%95%B0%E6%9C%80%E5%A4%9A%E7%9A%84%E5%89%8D20%E5%BC%BA%E6%AF%94%E8%B5%9B%E9%98%9F%E4%BC%8D"><span class="toc-text">获取获胜场数最多的前20强比赛队伍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%A5%E4%B8%8B%E6%9D%A5%E5%9C%A8%E5%88%86%E6%9E%90%E4%B8%8B%E5%90%84%E9%98%9F%E7%9A%84%E8%BF%9B%E7%90%83%E6%95%B0%E6%83%85%E5%86%B5"><span class="toc-text">接下来在分析下各队的进球数情况</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E6%9E%901872%E5%B9%B4%E4%BB%A5%E6%9D%A5%E6%8C%89%E8%83%9C%E5%9C%BA%E6%95%B0%E6%8E%92%E5%90%8D%E7%9A%8432%E5%BC%BA%E6%95%B0%E6%8D%AE%E6%83%85%E5%86%B5"><span class="toc-text">分析1872年以来按胜场数排名的32强数据情况</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%8D%E7%9C%8B%E7%9C%8B%E4%BB%8E1978%E5%B9%B4%E8%87%B3%E4%BB%8A%E7%9A%84%E8%83%9C%E5%9C%BA%E6%8E%92%E5%90%8D%E5%89%8D32%E9%98%9F%E4%BC%8D%E6%95%B0%E6%8D%AE"><span class="toc-text">再看看从1978年至今的胜场排名前32队伍数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%84%B6%E5%90%8E%E6%98%AF%E8%87%AA1978%E5%B9%B4%E4%BB%A5%E6%9D%A5%E7%9A%84%E8%BF%9B%E7%90%83%E6%95%B0%E6%8E%92%E5%90%8D%E5%89%8D32%E9%98%9F%E4%BC%8D%E7%9B%B8%E5%85%B3%E6%95%B0%E6%8D%AE%EF%BC%9A"><span class="toc-text">然后是自1978年以来的进球数排名前32队伍相关数据：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%8D%E5%88%86%E6%9E%90%E4%B8%8B%E4%BB%8E2002%E5%B9%B4%E4%BB%A5%E6%9D%A5%E7%9A%84%E7%9B%B8%E5%85%B3%E6%95%B0%E6%8D%AE%E6%83%85%E5%86%B5%EF%BC%9A"><span class="toc-text">再分析下从2002年以来的相关数据情况：</span></a></li></ol></li></ol></div><div class="column is-9"><header class="my-4"><a href="/tags/Python,%20Pandas"><i class="tag post-item-tag">Python, Pandas</i></a></header><h1 class="mt-0 mb-1 is-family-serif" id="postTitle">实战项目练习-【2018世界杯】用Python分析夺冠球队</h1><time class="has-text-grey" datetime="2019-05-20T11:22:24.000Z">2019-05-20</time><article class="mt-2 post-content"><p><img src="http://upload-images.jianshu.io/upload_images/1515206-214ebdbf1561743b.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="2018世界杯"></p>
<h2 id="前言">前言</h2>
<p>在网上找到了个用Python分析2018世界杯夺冠热门的项目，感觉很有意思准备拿来练练手。<br>
因为目前还没有学到图形可视化部分，所以这部分内容会完全借鉴网上的教程。</p>
<h2 id="分析目的">分析目的</h2>
<p>通过数据分析找出哪些队伍是这次世界杯的夺冠热门球队</p>
<h2 id="开发环境">开发环境</h2>
<ul>
<li>Python 3.7</li>
<li>SublimeText2</li>
</ul>
<h2 id="初步分析数据情况">初步分析数据情况</h2>
<pre><code>import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
from pandas import DataFrame,Series


df = pd.read_csv('results.csv')
print(df.head())
</code></pre>
<p><em>由于sublimetext上打印数据显示不全，所以打印数据放在ipython中了</em></p>
<pre><code>In [39]: df.head()
Out[39]:
         date home_team away_team  home_score  away_score tournament     city   country  neutral
0  1872-11-30  Scotland   England           0           0   Friendly  Glasgow  Scotland    False
1  1873-03-08   England  Scotland           4           2   Friendly   London   England    False
2  1874-03-07  Scotland   England           2           1   Friendly  Glasgow  Scotland    False
3  1875-03-06   England  Scotland           2           2   Friendly   London   England    False
4  1876-03-04  Scotland   England           3           0   Friendly  Glasgow  Scotland    False
</code></pre>
<p>目前包含有9种数据：日期、主队名、客队名、主队进球数、客队进球数、比赛类型、所在城市、所在国家、是否中立。<br>
但是想要知道夺冠热门球队，光这些数据还不够。</p>
<h2 id="分析思路">分析思路</h2>
<ul>
<li>因为我们这次分析的是世界杯的夺冠热门，首先需要排除掉像友谊赛，亚洲杯等比赛数据。</li>
<li>这批数据是从1873年至2014年的比赛数据，所以一个国家队肯定换过好多批阵容了，早年强的队伍近期不一定强，需要以时间段对它们进行分析。</li>
<li>想要分析黑马球队，需要一个球队的胜率以及进球数。目前数据中缺少胜利队伍的变量，需要我们加进去。</li>
</ul>
<h2 id="获取世界杯相关数据">获取世界杯相关数据</h2>
<pre><code># 通过在比赛类型中抓取包含'FIFA'字符来获取世界杯数据
df_FIFA_all = df[df['tournament'].str.contains('FIFA', regex=True)]

# 其中世界杯类型的数据也蛮乱的，‘FIFA World Cup’以及‘FIFA World Cup qualification’都有，只提取‘FIFA World Cup’部分

df_FIFA = df_FIFA_all[df_FIFA_all['tournament']=='FIFA World Cup']
print(df_FIFA.head())
</code></pre>
<h2 id="整理数据">整理数据</h2>
<ul>
<li>要分析球队的获胜场数，需要添加一个获胜队伍的字段。</li>
<li>为了方便分割年份，添加一个‘届数’的字段。</li>
<li>统一时间数据格式</li>
</ul>
<pre><code># 在做数据修改以前，先做拷贝
df_FIFA_COPY = df.copy()

df_FIFA_COPY.loc[:,'date'] = pd.to_datetime(df_FIFA_COPY.loc[:,'date'])
df_FIFA_COPY['session'] = df_FIFA_COPY['date'].dt.year
# 添加分差值，方便后面确定获胜队伍
df_FIFA_COPY['diff_score'] = df_FIFA_COPY['home_score']-df_FIFA_COPY['away_score']

df_FIFA_COPY['win_team'] = ''
df_FIFA_COPY['diff_score'] = pd.to_numeric(df_FIFA_COPY['diff_score'])
</code></pre>
<p>上面部分添加了年份这个参数，添加了获胜队伍的参数还未填入数据，还确定了分差值。</p>
<p><strong>确认获胜队伍，填入<code>win_team</code>参数中</strong></p>
<pre><code>df_FIFA_COPY.loc[df_FIFA_COPY['diff_score']&gt; 0, 'win_team'] = df_FIFA_COPY.loc[df_FIFA_COPY['diff_score']&gt; 0, 'home_team']
df_FIFA_COPY.loc[df_FIFA_COPY['diff_score']&lt; 0, 'win_team'] = df_FIFA_COPY.loc[df_FIFA_COPY['diff_score']&lt; 0, 'away_team']
df_FIFA_COPY.loc[df_FIFA_COPY['diff_score']== 0, 'win_team'] = 'Draw'

print(df_FIFA_COPY.head())
</code></pre>
<p>结果如下：</p>
<pre><code>           date  home_team   away_team  ...  session  diff_score    win_team
1277 1930-07-13    Belgium         USA  ...     1930          -3         USA
1278 1930-07-13     France      Mexico  ...     1930           3      France
1279 1930-07-14     Brazil  Yugoslavia  ...     1930          -1  Yugoslavia
1280 1930-07-14       Peru     Romania  ...     1930          -2     Romania
1281 1930-07-15  Argentina      France  ...     1930           1   Argentina
</code></pre>
<p>现在已经获得了获胜队伍的数据，接下来通过对获胜队伍这个参数的统计来分析出前20强队伍：</p>
<h2 id="获取获胜场数最多的前20强比赛队伍">获取获胜场数最多的前20强比赛队伍</h2>
<pre><code>s = df_FIFA_COPY.groupby('win_team')['win_team'].count()
s.drop(labels=['Draw'], inplace=True)
s.sort_values(ascending=False, inplace=True)
</code></pre>
<p>显示柱形图</p>
<pre><code>
s.head(20).plot(kind='bar', figsize=(10,6), title='Top 20 Winner of World')
plt.show()
</code></pre>
<p><img src="https://upload-images.jianshu.io/upload_images/1515206-e13ca9312f922fe1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="1.png"></p>
<p>柱状图中已经明确显示了前20强的队伍，其中巴西、德国、意大利、阿根廷、西班牙、法国等最为突出，他们的胜场占比非常的高。</p>
<p>再来查看下饼图情况：</p>
<pre><code>#
s = df_FIFA_COPY.groupby('win_team')['win_team'].count()
s.drop(labels=['Draw'], inplace=True)

s.sort_values(ascending=True,inplace=True)


# 饼图

s_percentage = s/s.sum()
s_percentage
s_percentage.tail(20).plot(kind='pie', figsize=(10,10), autopct='%.1f%%',
                           startangle=173, title='Top 20 Winners of World Cup', label='')

</code></pre>
<p><img src="https://upload-images.jianshu.io/upload_images/1515206-56aceca0eb9a01e7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="WechatIMG37.png"></p>
<p>通过百分比更能清晰的看到强队在整个世界杯历史中胜场比数。初步分析下来，从赢球场数来看，巴西、德国、意大利、阿根廷四支球队实力最强。</p>
<h2 id="接下来在分析下各队的进球数情况">接下来在分析下各队的进球数情况</h2>
<pre><code># 进球数统计
df_score_home = df_FIFA[['home_team','home_score']]
column_update = ['team','score']
df_score_home.columns = column_update
df_score_away = df_FIFA[['away_team','away_score']]
df_score_away.columns = column_update
df_score = pd.concat([df_score_home,df_score_away], ignore_index=True)
s_score = df_score.groupby('team')['score'].sum()
s_score.sort_values(ascending=False, inplace=True)
s_score.sort_values(ascending=True, inplace=True)
s_score.tail(20).plot(kind='barh', figsize=(10,6), title='Top 20 in Total Scores of World Cup')
plt.show()
</code></pre>
<p><img src="https://upload-images.jianshu.io/upload_images/1515206-7cd53a901614466f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="WechatIMG38.png"></p>
<p>从进球数的分析结果来看，德国、巴西、阿根廷、意大利这四支球队最强，结合上面的胜场数分析同样也是这四支球队排名最靠前。</p>
<p>开篇准备的分析思路里第一条和第三条已经完成了。</p>
<h2 id="分析1872年以来按胜场数排名的32强数据情况">分析1872年以来按胜场数排名的32强数据情况</h2>
<pre><code>df_top32 = df_FIFA_COPY.copy()

s_32 = df_top32.groupby('win_team')['win_team'].count()
s_32.sort_values(ascending=False, inplace=True)
s_32.drop(labels=['Draw'], inplace=True)
s_32.sort_values(ascending=True,inplace=True)
s_32.plot(kind='barh', figsize=(8,12), title='Top 32 of World Cup since year 1872')
</code></pre>
<p><img src="https://upload-images.jianshu.io/upload_images/1515206-ea51b7bc47677d45.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="WechatIMG40.png"></p>
<h3 id="再看看从1978年至今的胜场排名前32队伍数据">再看看从1978年至今的胜场排名前32队伍数据</h3>
<pre><code>df_since1978 = df_FIFA_COPY.loc[df_FIFA_COPY['session'] &gt;= 1978]

s_32 = df_since1978.groupby('win_team')['win_team'].count()
s_32.sort_values(ascending=False, inplace=True)
s_32 = s_32[:32]
s_32.drop(labels=['Draw'], inplace=True)
s_32.sort_values(ascending=True,inplace=True)
s_32.plot(kind='barh', figsize=(8,12), title='Top 32 of World Cup since year 1978')
plt.show()
</code></pre>
<p><img src="https://upload-images.jianshu.io/upload_images/1515206-f74256993b167681.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="WechatIMG41.png"></p>
<h3 id="然后是自1978年以来的进球数排名前32队伍相关数据：">然后是自1978年以来的进球数排名前32队伍相关数据：</h3>
<pre><code>df_score_home = df_since1978[['home_team','home_score']]
column_update = ['team','score']
df_score_home.columns = column_update
df_score_away = df_FIFA[['away_team','away_score']]
df_score_away.columns = column_update
df_score = pd.concat([df_score_home,df_score_away], ignore_index=True)
s_score = df_score.groupby('team')['score'].sum()
s_score.sort_values(ascending=False, inplace=True)
s_score=s_score[:32]
s_score.sort_values(ascending=True, inplace=True)
s_score.tail(32).plot(kind='barh', figsize=(10,6), title='Top 32 in Total Scores of World Cup since year 1978')
plt.show()

</code></pre>
<p>代码都差不多就不再重复解释了<br>
<img src="https://upload-images.jianshu.io/upload_images/1515206-226db6b80fa0e1fd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="WechatIMG42.png"></p>
<p>在这两组数据中，巴西、阿根廷、德国、意大利排名稳坐前四。</p>
<h3 id="再分析下从2002年以来的相关数据情况：">再分析下从2002年以来的相关数据情况：</h3>
<p>自2002以来胜场排名数据：<br>
<img src="https://upload-images.jianshu.io/upload_images/1515206-0236c335ecb851f4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="2002-winteam.png"></p>
<p>自2002以来得分排名数据：<br>
<img src="https://upload-images.jianshu.io/upload_images/1515206-837122343dae7028.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="2002-score.png"></p>
<p>个人分析总结：<br>
从这两组数据中可以看到，德国队在胜场和得分数上有很大的优势。虽然个人不大懂如何分析球队，但是光看这个数据觉得德国队在2018世界杯的赢面还是蛮大的。而排名第二、三的巴西、阿根廷、意大利在数据上明显差了德国队一截。</p>
<p>最终结论：2018世界杯冠军应该在前四强德国、巴西、意大利、阿根廷中产出。此次数据分析当做练习来用，而且2018年世界杯老早已经过了。</p>
<p>#技术总结<br>
在这里主要涉及到了一些基础功能点：</p>
<ul>
<li>读取csv文件</li>
<li>数据整理：去除了和世界杯无关的数据、添加新变量获胜队伍<code>win_team</code>，<code>diff_score</code>分差值、</li>
<li>按关键字对数据排序</li>
<li>matplotlib库的初步使用，生成柱形图和饼图</li>
<li>数据分割与截取</li>
</ul>
</article><section class="jump-container is-flex is-justify-content-space-between my-6"><!-- em is empty placeholder--><a class="button is-default" href="/data-analyst/Python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E4%B9%8BPandas-matplotlib%E5%9F%BA%E7%A1%80%E5%8A%9F%E8%83%BD%EF%BC%88%E4%B8%80%EF%BC%89/" title="Python数据分析之Pandas-matplotlib基础功能（一）"><i class="iconfont icon-prev mr-2 has-text-grey"></i><span class="has-text-weight-semibold">上一页: Python数据分析之Pandas-matplotlib基础功能（一）</span></a><a class="button is-default" href="/data-analyst/%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE%E7%BB%83%E4%B9%A0-%E9%93%BE%E5%AE%B6%E4%BA%8C%E6%89%8B%E6%88%BF%E6%95%B0%E6%8D%AE%EF%BC%88%E6%B8%85%E6%B4%97%E4%B8%8E%E5%90%88%E5%B9%B6%EF%BC%89/" title="实战项目练习-链家二手房数据（清洗与合并）"><span class="has-text-weight-semibold">下一页: 实战项目练习-链家二手房数据（清洗与合并）</span><i class="iconfont icon-next ml-2 has-text-grey"></i></a></section><article class="mt-6 comment-container"><script async repo="fuer4869/fuer4869.github.io" src="https://utteranc.es/client.js" issue-term="pathname" theme="preferred-color-scheme"></script></article></div></div></main></main><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0 is-family-serif"><section class="sns-container"><a title="twitter" target="_blank" rel="noopener nofollow" href="//twitter.com//"><i class="iconfont icon-twitter"></i></a><!-- Github--><a title="github" target="_blank" rel="noopener nofollow" href="//github.com/fuer4869"><i class="iconfont icon-github"></i></a><!-- Ins--><a title="instagram" target="_blank" rel="noopener nofollow" href="//www.instagram.com//"><i class="iconfont icon-ins"></i></a><!-- RSS--><!-- 知乎--><!-- 领英--><!-- 脸书--><a title="facebook" target="_blank" rel="noopener nofollow" href="//www.facebook.com//"><i class="iconfont icon-tian7_facebook"></i></a></section><p><span>Copyright ©</span><span> loannes 2021</span></p><div class="is-flex is-justify-content-center is-flex-wrap-wrap"><p>Powered by Hexo &verbar;&nbsp;</p><p class="is-flex is-justify-content-center"><a title="Hexo theme author" target="_blank" rel="noopener" href="//github.com/haojen">Theme by Haojen&nbsp;</a></p><div style="margin-top: 2px"><a class="github-button" title="github-button" target="_blank" rel="noopener" href="https://github.com/haojen/hexo-theme-Claudia" data-color-scheme="no-preference: light; light: light; dark: dark;" data-show-count="true"></a></div></div></footer><script async defer src="https://buttons.github.io/buttons.js"></script><script src="/js/post.js"></script></body></html>